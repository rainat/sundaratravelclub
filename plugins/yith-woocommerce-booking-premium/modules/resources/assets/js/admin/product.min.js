!function(s,e){var o,t,n,a=wp.i18n._x,i={table:wp.template("yith-wcbk-resources-modal-table"),blank:wp.template("yith-wcbk-resources-modal-content-blank"),content:wp.template("yith-wcbk-resources-modal-content"),resourceData:wp.template("yith-wcbk-product-resource-data")},c={main:s("#yith-wcbk-booking-product-resources"),list:s("#yith-wcbk-booking-product-resources__list")},d=c.main.data("resource-ids")||[],r=function(e){var t,c,r;n&&(r=(e=e||{}).data||{},t=e.block||{},c=e.firstLoad||!1,r=s.extend(r,{request:"resources_get_resources"}),o&&o.abort(),o=yith_booking.adminAjax(r,{block:t}).done(function(e){var t,o,a;e.success&&((a=e.data).product_resource_ids=d,a.page=r.page||1,c?(n.elements.content.html(""),t=s(i.content()),o=(t=e.data.items.length?t:s(i.blank())).find("#yith-wcbk-resources-modal-table-wrapper"),n.elements.content.append(t)):(o=s("#yith-wcbk-resources-modal-table-wrapper")).html(""),e=s(i.table(a)),o.append(e),c)&&s("#yith-wcbk-resources-modal-search").trigger("focus")}))},l=function(){d=e.uniq(d),c.main.data("resource-ids",d)},u=function(t){d=d.filter(function(e){return e!==t}),l(),c.list.find(".yith-wcbk-booking-product-resource[data-id="+t+"]").remove(),c.list.find(".yith-wcbk-booking-product-resource").length?c.main.addClass("has-resources"):c.main.removeClass("has-resources")},b=(s(document).on("click",".yith-wcbk-booking-product-resources__add",function(e){e.preventDefault(),n=yith.ui.modal({classes:{wrap:"yith-wcbk-resources-modal"},title:a("Add resources","Modal title","yith-booking-for-woocommerce"),scrollContent:!1,width:700,onClose:function(){n=!1}}),r({block:n.elements.content,firstLoad:!0})}),s(document).on("keyup","#yith-wcbk-resources-modal-search",function(){var e=s(this).val();t&&clearTimeout(t),t=setTimeout(function(){r({data:{search:e},block:n.elements.content})},300)}),s(document).on("click",".yith-wcbk-resources-modal-table .resource .resource__actions .add",function(){var e=s(this).closest(".resource"),t={id:e.data("id"),name:e.data("name"),image:e.data("image")};t=t,d.push(t.id),l(),c.list.append(s(i.resourceData(t))),c.main.addClass("has-resources"),s(document).trigger("yith_wcbk_product_metabox_dynamic_durations"),e.addClass("added")}),s(document).on("click",".yith-wcbk-resources-modal-table .resource .resource__actions .remove",function(){var e=s(this).closest(".resource"),t=e.data("id");u(t),e.removeClass("added")}),s(document).on("click",".yith-wcbk-booking-product-resource__remove",function(){var e=s(this).closest(".yith-wcbk-booking-product-resource").data("id");u(e)}),s(document).on("click",".yith-wcbk-resources-modal-table__pagination .pagination-action",function(e){e.preventDefault(),e.stopPropagation();var e=s(this),t=e.closest(".yith-wcbk-resources-modal-table__pagination"),o=t.data("current-page"),t=t.data("total-pages");e.is(".disabled")||0<(e=e.is(".next")?o+1:o-1)&&e<=t&&(o={page:e},(t=s("#yith-wcbk-resources-modal-search").val())&&(o.search=t),r({data:o,block:n.elements.content}))}),s("#_yith_booking_resources_label")),m=s("#_yith_booking_resources_field_label"),h=m.attr("placeholder"),k=function(){var e=b.val();m.attr("placeholder",e||h)};b.on("keyup",k),k()}(jQuery,lodash);
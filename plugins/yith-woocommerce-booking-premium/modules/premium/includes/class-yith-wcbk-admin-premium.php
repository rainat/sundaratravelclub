<?php
/**
 * Class YITH_WCBK_Admin_Premium
 *
 * @author  YITH <plugins@yithemes.com>
 * @package YITH\Booking\Modules\Premium
 */

defined( 'YITH_WCBK' ) || exit;

if ( ! class_exists( 'YITH_WCBK_Admin_Premium' ) ) {
	/**
	 * YITH_WCBK_Admin_Premium class.
	 */
	class YITH_WCBK_Admin_Premium extends YITH_WCBK_Admin {

		/**
		 * The constructor.
		 */
		protected function __construct() {
			parent::__construct();

			add_filter( 'yith_wcbk_panel_settings_sub_tabs', array( $this, 'filter_settings_sub_tabs' ), 10, 1 );
		}

		/**
		 * Retrieve the documentation URL.
		 *
		 * @return string
		 */
		protected function get_doc_url(): string {
			return 'https://docs.yithemes.com/yith-woocommerce-booking/';
		}

		/**
		 * Get items to be shown in "Your store tools" tab.
		 *
		 * @return array
		 */
		protected function get_your_store_tools_items(): array {
			$items = array(
				'deposits'          => array(
					'name'           => 'Deposits and Down Payments',
					'url'            => '//yithemes.com/themes/plugins/yith-woocommerce-deposits-and-down-payments/',
					'description'    => __( 'Allow your customers to <strong>pay a deposit to book products or services</strong> and pay the balance at a later time.', 'yith-booking-for-woocommerce' ),
					'is_active'      => defined( 'YITH_WCDP_PREMIUM_INIT' ),
					'is_recommended' => true,
				),
				'badge-management'  => array(
					'name'        => 'Badge Management',
					'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-badge-management/',
					'description' => array(
						__( 'Show graphic badges on your products to highlight discounts, promotions, or unique selling points.', 'yith-booking-for-woocommerce' ),
						__( 'Show them on product pages, the shop page, and in the booking search popup.', 'yith-booking-for-woocommerce' ),
					),
					'is_active'   => defined( 'YITH_WCBM_PREMIUM' ),
				),
				'catalog-mode'      => array(
					'name'        => 'Catalog Mode',
					'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-catalog-mode/',
					'description' => __( 'Use your shop as a catalog by hiding prices and/or the "Add to cart" button on product pages.', 'yith-booking-for-woocommerce' ),
					'is_active'   => defined( 'YWCTM_PREMIUM' ),
				),
				'email-templates'   => array(
					'name'        => 'Email Templates',
					'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-email-templates/',
					'description' => __( 'Manage and customize the templates of the emails sent from your store for a more professional look.', 'yith-booking-for-woocommerce' ),
					'is_active'   => defined( 'YITH_WCET_PREMIUM' ),
				),
				'multi-vendor'      => array(
					'name'        => 'Multi Vendor',
					'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-multi-vendor/',
					'description' => __( 'Turn your e-commerce store into a marketplace (a multi-vendor platform) and earn commissions on orders generated by your vendors.', 'yith-booking-for-woocommerce' ),
					'is_active'   => defined( 'YITH_WPV_PREMIUM' ),
				),
				'quick-view'        => array(
					'name'        => 'Quick View',
					'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-quick-view/',
					'description' => __( 'You will have the possibility to add the Quick View functionality to your shop and show the information related to the product in a modal window.', 'yith-booking-for-woocommerce' ),
					'is_active'   => defined( 'YITH_WCQV_PREMIUM' ),
				),
				'request-a-quote'   => array(
					'name'        => 'Request a Quote',
					'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-request-a-quote/',
					'description' => __( 'Hide prices and/or "Add to cart" buttons and let your customers request a custom quote for every product.', 'yith-booking-for-woocommerce' ),
					'is_active'   => defined( 'YITH_YWRAQ_PREMIUM' ),
				),
				'sms-notifications' => array(
					'name'        => 'SMS Notifications',
					'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-sms-notifications/',
					'description' => __( 'Stay updated with your orders and bookings: <strong>send an SMS</strong> to your customers and <strong>receive the SMS</strong> as admin <strong>every time an order status or a booking status changes</strong>.', 'yith-booking-for-woocommerce' ),
					'is_active'   => defined( 'YWSN_PREMIUM' ),
				),
			);

			foreach ( $items as $key => $item ) {
				if ( is_array( $item['description'] ) ) {
					$items[ $key ]['description'] = implode( '<br />', $item['description'] );
				}

				$items[ $key ]['icon_url'] = YITH_WCBK_ASSETS_URL . '/images/plugins/' . $key . '.svg';
			}

			return $items;
		}

		/**
		 * Retrieve the panel arguments.
		 *
		 * @return array
		 * @since 4.0.0
		 */
		protected function get_panel_args(): array {
			$args = parent::get_panel_args();

			unset( $args['premium_tab'] );

			$args['help_tab'] = array(
				'hc_url'     => 'https://support.yithemes.com/hc/en-us/categories/360003475718-YITH-BOOKING-AND-APPOINTMENT-FOR-WOOCOMMERCE',
				'main_video' => array(
					'desc' => _x( 'Check this video to learn how to <b>create a bookable product:</b>', 'Help tab - Video title', 'yith-booking-for-woocommerce' ),
					'url'  => array(
						'en' => 'https://www.youtube.com/embed/PLLkF00Yi5c',
						'it' => 'https://www.youtube.com/embed/rqKNScId3EM',
						'es' => 'https://www.youtube.com/embed/jLt6nMBP2hI',
					),
				),
				'playlists'  => array(
					'en' => 'https://www.youtube.com/watch?v=PLLkF00Yi5c&list=PLDriKG-6905ms1mFDpE4JXuMAynEdRWuO&ab_channel=YITH',
					'it' => 'https://www.youtube.com/watch?v=rqKNScId3EM&list=PL9c19edGMs08ZMg-UicCpYppFKkUS7u4p&ab_channel=YITHITALIA',
					'es' => 'https://www.youtube.com/watch?v=jLt6nMBP2hI&list=PL9Ka3j92PYJMcKsorA7ULPt2cJuITSaXr&ab_channel=YITHESPA%C3%91A',
				),
			);

			$args['welcome_modals']['modals']['welcome']['items'] = array(
				'documentation'  => array(),
				'how-to-video'   => array(
					'description' => __( 'See how it works before you set up your products', 'yith-booking-for-woocommerce' ),
					'url'         => array(
						'en' => 'https://www.youtube.com/watch?v=PLLkF00Yi5c',
						'it' => 'https://www.youtube.com/watch?v=rqKNScId3EM',
						'es' => 'https://www.youtube.com/watch?v=jLt6nMBP2hI',
					),
				),
				'modules'        => array(
					'title'       => __( '<mark>Pick the "Modules"</mark> you need for your store', 'yith-booking-for-woocommerce' ),
					'description' => __( 'People, Services, Resources, Extra Costs and Discounts and so much more', 'yith-booking-for-woocommerce' ),
					'url'         => add_query_arg(
						array(
							'page' => YITH_WCBK_Admin::PANEL_PAGE,
							'tab'  => 'modules',
						),
						admin_url( 'admin.php' )
					),
				),
				'create-product' => array(
					'title'       => __( 'Are you ready? Create your first <mark>bookable product</mark>', 'yith-booking-for-woocommerce' ),
					'description' => __( '...and start the adventure!', 'yith-booking-for-woocommerce' ),
					'url'         => add_query_arg(
						array(
							'post_type'                     => 'product',
							'yith-wcbk-new-booking-product' => 1,
						),
						admin_url( 'post-new.php' )
					),
				),
			);

			$args['welcome_modals']['modals']['update'] = array(
				'type'  => 'update',
				'show'  => get_option( 'yith-wcbk-welcome-modal', 'welcome' ) === 'update',
				'since' => '4.0',
				'items' => array(
					'modules'   => array(
						'title'       => __( 'Say welcome to our "Modules" concept', 'yith-booking-for-woocommerce' ),
						'description' => __( 'People, Services, Extra Costs, Discounts, etc. , enable only the features you really need for your site for a better performance.', 'yith-booking-for-woocommerce' ),
						'url'         => add_query_arg(
							array(
								'page' => self::PANEL_PAGE,
								'tab'  => 'modules',
							),
							admin_url( 'admin.php' )
						),
					),
					'resources' => array(
						'title'       => __( 'Associate unlimited "Resources" to your products', 'yith-booking-for-woocommerce' ),
						'description' => __( 'Create unlimited "resources" (e.g:  equipment, staff, technology, software, etc.) to associate for your bookable products.', 'yith-booking-for-woocommerce' ),
						'url'         => '',
					),
					'blocks'    => array(
						'title'       => __( 'Gutenberg block for the booking forms', 'yith-booking-for-woocommerce' ),
						'description' => __( 'Blocks are the future, so we created a Gutenberg block to easily insert the booking forms in any page.', 'yith-booking-for-woocommerce' ),
						'url'         => '',
					),
					'deposits'  => array(
						// translators: %s is the plugin name.
						'title'       => sprintf( __( 'New integration: %s', 'yith-booking-for-woocommerce' ), 'YITH WooCommerce Deposits & Down Payments' ),
						'description' => __( 'Allow your customers to pay a deposit to book products or services and pay the balance at a later time (e.g.: 5 days before the booking start date)', 'yith-booking-for-woocommerce' ),
						'url'         => '//yithemes.com/themes/plugins/yith-woocommerce-deposits-and-down-payments/',
						'cta'         => __( 'Discover our Deposits & Down Payments plugin >', 'yith-booking-for-woocommerce' ),
					),
				),
			);

			$args['your_store_tools'] = array(
				'items' => $this->get_your_store_tools_items(),
			);

			$args['is_extended'] = false;
			$args['is_premium']  = true;

			return $args;
		}

		/**
		 * Filter settings sub-tabs to add premium tabs.
		 *
		 * @param array $sub_tabs The sub-tabs.
		 *
		 * @return array
		 */
		public function filter_settings_sub_tabs( array $sub_tabs ): array {
			$premium_sub_tabs = array(
				'settings-general-settings' => array(
					'title'              => _x( 'General Settings', 'Tab title in plugin settings panel', 'yith-booking-for-woocommerce' ),
					'description'        => __( 'Set the general options for the plugin behavior.', 'yith-booking-for-woocommerce' ),
					'yith-wcbk-priority' => 1,
					'options_path'       => yith_wcbk_get_module_path( 'premium', 'options/settings/general-settings-options.php' ),
				),
				'settings-cart'             => array(
					'title'              => _x( 'Cart & Orders', 'Tab title in plugin settings panel', 'yith-booking-for-woocommerce' ),
					'description'        => __( 'Set the options related to the cart and orders management.', 'yith-booking-for-woocommerce' ),
					'yith-wcbk-priority' => 40,
					'options_path'       => yith_wcbk_get_module_path( 'premium', 'options/settings/cart-options.php' ),
				),
			);

			return array_merge( $sub_tabs, $premium_sub_tabs );
		}

		/**
		 * Filter row meta documentation URL.
		 *
		 * @param string $url   Current URL.
		 * @param string $field The row meta field.
		 * @param string $slug  The current plugin slug.
		 *
		 * @return string
		 * @since 4.0.0
		 */
		public function filter_row_meta_documentation_url( $url, $field, $slug ) {
			return $url;
		}

	}
}

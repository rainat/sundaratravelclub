!function(o,e){"use strict";var a=e.i18n.__,t=function(){o(document.body).trigger("wc-enhanced-select-init")},l={dom:{rulesContainer:o(".yith-wcbk-availability-rules").first(),blankState:o(".yith-wcbk-availability-rules__blank-state"),rulesList:!1,newRuleButton:o(".yith-wcbk-availability-rules__new-rule"),expandCollapseButton:o(".yith-wcbk-availability-rules__expand-collapse"),saveSettingsButton:o("#yith-wcbk-settings-tab-actions-save"),form:o("form#post, form#yith-wcbk-global-availability")},ruleToAdd:!1,addRuleModal:!1,indexes:{rules:1,dataRanges:1},templates:{rule:e.template("yith-wcbk-availability-rule")},hasTime:!1,_initParams:function(){this.dom.rulesList=this.dom.rulesContainer.find(".yith-wcbk-availability-rules__list"),this.indexes.rules=this.dom.rulesList.find(".yith-wcbk-availability-rule").length||0},init:function(){this._initParams(),o(document).on("change yith_wcbk_admin_booking_availability_rule_type_change",".yith-wcbk-availability-rule__type",this.handleTypeChange),this.dom.newRuleButton.on("click",this.openAddRuleModal),o(document).on("click",".yith-wcbk-availability-rule__add-rule",this.addRule),o(document).on("click",".yith-wcbk-availability-rule__delete-rule",this.deleteRule),this.dom.expandCollapseButton.on("click",this.expandCollapseAll),this.expandCollapseVisibility(),o(".yith-wcbk-availability-rule__type").each(function(){l.handleTypeChange.call(o(this))}),this.checkIfHasRules()},checkIfHasRules:function(){l.dom.rulesList.find(".yith-wcbk-availability-rule").length?l.dom.rulesContainer.addClass("yith-wcbk-availability-rules--has-rules"):l.dom.rulesContainer.removeClass("yith-wcbk-availability-rules--has-rules")},handleTypeChange:function(){var i=o(this).val(),e=o(this).closest(".yith-wcbk-availability-rule"),a=e.find(".bk_ar_enable_if_type_specific"),t=a.find("input, select, textarea"),l=e.find(".bk_ar_enable_if_type_generic"),n=l.find("input, select, textarea");"specific"===i?(a.prop("disabled",!1),t.prop("disabled",!1),l.attr("disabled","disabled"),n.attr("disabled","disabled"),e.removeClass("yith-wcbk-availability-rule--generic-type").addClass("yith-wcbk-availability-rule--specific-type")):(l.prop("disabled",!1),n.prop("disabled",!1),a.attr("disabled","disabled"),t.attr("disabled","disabled"),e.removeClass("yith-wcbk-availability-rule--specific-type").addClass("yith-wcbk-availability-rule--generic-type"))},getRuleToAdd:function(){return l.ruleToAdd},openAddRuleModal:function(i){i.preventDefault(),l.getRuleToAdd()||(i=l.nextIndex(),l.ruleToAdd=o(l.templates.rule({ruleIndex:i})),l.addRuleModal=yith.ui.modal({title:a("Create rule","yith-booking-for-woocommerce"),classes:{main:"yith-wcbk-availability-rules__create-modal"},content:l.ruleToAdd,width:1024,onClose:function(){l.ruleToAdd=!1},onCreate:function(){l.ruleToAdd.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),t(),l.handleTypeChange.call(l.ruleToAdd.find(".yith-wcbk-availability-rule__type")),l.ruleToAdd.find(".yith-wcbk-availability-rule__title-field").focus()}}))},addRule:function(i){i.preventDefault();i=o(this).closest(".yith-wcbk-availability-rule");i.find(".yith-wcbk-availability-rules__add-rule").remove(),l.dom.rulesList.append(i),l.addRuleModal&&l.addRuleModal.close(),l.addRuleModal=!1,l.expandCollapseVisibility(),l.attentionForSaving(),l.checkIfHasRules()},deleteRule:function(i){i.preventDefault(),o(i.target).closest(".yith-wcbk-availability-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){o(this).remove(),l.expandCollapseVisibility(),l.attentionForSaving(),l.checkIfHasRules()})},nextIndex:function(){return++l.indexes.rules},expandCollapseAll:function(i){var i=o(i.target).closest(".yith-wcbk-availability-rules__expand-collapse"),e=l.dom.rulesList;(i.is(".yith-wcbk-availability-rules__expand-collapse--collapse")?(i.removeClass("yith-wcbk-availability-rules__expand-collapse--collapse"),e.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle")):(i.addClass("yith-wcbk-availability-rules__expand-collapse--collapse"),e.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle"))).click()},expandCollapseVisibility:function(){l.dom.rulesList.find(".yith-wcbk-availability-rule").length?l.dom.expandCollapseButton.show():l.dom.expandCollapseButton.hide()},attentionForSaving:function(){l.dom.saveSettingsButton.length&&(l.dom.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),l.dom.saveSettingsButton.outerWidth(),l.dom.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}},i=(l.init(),function(d){var i={template:"",selectors:{main:!1,wrap:!1,list:!1,row:!1,add:!1,remove:!1},indexes:{main:"ruleIndex",row:"availabilityIndex"},filterNewRowData:!1,onAddRow:!1,beforeDeleteRow:!1,onDeleteRow:!1},t=((d=o.extend({},i,d)).selectors=o.extend({},i.selectors,d.selectors),d.indexes=o.extend({},i.indexes,d.indexes),{});t.template=e.template(d.template),t._init=function(){o(document).on("click",d.selectors.add,t.addRow),o(document).on("click",d.selectors.remove,t.deleteRow)},t.getRelatedData=function(i){var i=i.target?o(i.target):o(i),e=!!d.selectors.main&&i.closest(d.selectors.main),i=e?e.find(d.selectors.wrap):i.closest(d.selectors.wrap),a=i.find(d.selectors.list),t=a.find(d.selectors.row),l=Math.max.apply(null,t.get().map(function(i){return parseInt(o(i).data("index"),10)})),n={},l=(e&&(n[d.indexes.main]=e.data("index")),n[d.indexes.row]=l+1,{main:e,wrap:i,list:a,rows:t,add:i.find(d.selectors.add)});return{dom:l,newRowData:n="function"==typeof d.filterNewRowData?d.filterNewRowData(o.extend({},n),o.extend({},l)):n}},t.addRow=function(i){var i=t.getRelatedData(i),e=o(t.template(i.newRowData));i.dom.list.append(e),"function"==typeof d.onAddRow&&d.onAddRow(e,t.getRelatedData(e))},t.deleteRow=function(i){var e=!0,a=o(this).closest(d.selectors.row),i=t.getRelatedData(i);(e="function"==typeof d.beforeDeleteRow?d.beforeDeleteRow(a,i):e)&&(a.remove(),"function"==typeof d.onDeleteRow)&&d.onDeleteRow(a,t.getRelatedData(i.dom.wrap))},t._init()}),n=function(i,e){t();var a=i.find(".yith-wcbk-availability__day"),e=(a.val("").trigger("change"),8<=e.dom.rows.length&&e.dom.add.hide(),a.find("option:not(:disabled)").first().val()||!1);e?a.val(e).trigger("change"):i.remove()},d=function(i,e){e.dom.rows.first().find(".yith-wcbk-availability__day").trigger("change"),e.dom.add.show()};i({template:"yith-wcbk-availability-rule-date-range",selectors:{main:".yith-wcbk-availability-rule",wrap:".yith-wcbk-availability-rule__date-ranges",list:".yith-wcbk-availability-rule__date-ranges__list",row:".yith-wcbk-availability-rule__date-range",add:".yith-wcbk-availability-rule__date-ranges__add-range",remove:".yith-wcbk-availability-rule__date-range__action--delete"},indexes:{main:"ruleIndex",row:"dateRangeIndex"},onAddRow:function(i,e){l.handleTypeChange.call(e.dom.main.find(".yith-wcbk-availability-rule__type")),i.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),t()}}),i({template:"yith-wcbk-availability-rule-availability",selectors:{main:".yith-wcbk-availability-rule",wrap:".yith-wcbk-availability-rule__availabilities",list:".yith-wcbk-availability-rule__availabilities__list",row:".yith-wcbk-availability-rule__availability",add:".yith-wcbk-availability-rule__availabilities__add-availability",remove:".yith-wcbk-availability-rule__availability__action--delete"},indexes:{main:"ruleIndex",row:"availabilityIndex"},onAddRow:n,onDeleteRow:d,beforeDeleteRow:function(i,e){return"all-day"===i.find(".yith-wcbk-availability__full-day-type").val()}}),i({template:"yith-wcbk-availability-rule-availability-time-slot",selectors:{main:".yith-wcbk-availability-rule__availability",wrap:".yith-wcbk-availability__time-slots",list:".yith-wcbk-availability__time-slots__list",row:".yith-wcbk-availability__time-slot",add:".yith-wcbk-availability-rule__availability__time-slots__add-time-slot",remove:".yith-wcbk-availability-rule__availability__time-slot__action--delete"},indexes:{main:"availabilityIndex",row:"timeSlotIndex"},onAddRow:function(){t()},filterNewRowData:function(i,e){return i.ruleIndex=e.main.closest(".yith-wcbk-availability-rule").data("index"),i},beforeDeleteRow:function(i,e){return!(e.dom.rows.length<2&&(e.dom.main.find(".yith-wcbk-availability__full-day-type").val("all-day").trigger("change"),1))}}),{init:function(){o(document).on("change",".yith-wcbk-availability__full-day-type",this.fullDayTypeChangeHandler),o(document).on("change",".yith-wcbk-availability__day",this.dayChangeHandler)},fullDayTypeChangeHandler:function(){var i=o(this).closest(".yith-wcbk-availability"),e=i.find(".yith-wcbk-availability__time-slots"),a=e.find(".yith-wcbk-availability__time-slots__list").find("input"),t=o(this).val();i.attr("data-full-day-type",t),"all-day"===t?(e.hide(),a.prop("disabled",!0)):(e.show(),a.prop("disabled",!1))},dayChangeHandler:function(){var i=o(this).closest(".yith-wcbk-availability").parent().find(".yith-wcbk-availability__day"),t=i.map(function(){return o(this).val()}).toArray();i.each(function(){var e=o(this).val(),a=t.filter(function(i){return i!==e}),i=o(this).find("option");i.prop("disabled",!1),i.each(function(){var i=o(this);0<=a.indexOf(i.val())&&i.prop("disabled",!0)})})}}.init(),i({template:"yith-wcbk-default-availability",selectors:{main:!1,wrap:".yith-wcbk-default-availabilities",list:".yith-wcbk-default-availabilities__list",row:".yith-wcbk-default-availabilities__availability",add:".yith-wcbk-default-availabilities__actions__add-availability",remove:".yith-wcbk-default-availabilities__availability__action--delete"},indexes:{row:"availabilityIndex"},onAddRow:n,onDeleteRow:d,beforeDeleteRow:function(i,e){return"all-day"===i.find(".yith-wcbk-availability__full-day-type").val()}}),i({template:"yith-wcbk-default-availability-time-slot",selectors:{main:".yith-wcbk-availability",wrap:".yith-wcbk-availability__time-slots",list:".yith-wcbk-availability__time-slots__list",row:".yith-wcbk-availability__time-slot",add:".yith-wcbk-default-availabilities__availability__time-slots__add-time-slot",remove:".yith-wcbk-default-availabilities__availability__time-slot__action--delete"},indexes:{main:"availabilityIndex",row:"timeSlotIndex"},onAddRow:function(){t()},beforeDeleteRow:function(i,e){return!(e.dom.rows.length<2&&(e.dom.main.find(".yith-wcbk-availability__full-day-type").val("all-day").trigger("change"),1))}})}(jQuery,wp);
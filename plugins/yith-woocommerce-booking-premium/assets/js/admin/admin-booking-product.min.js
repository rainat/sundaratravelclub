jQuery(function(a){"use strict";bk.blockParamsNoLoader;var t=bk.blockParamsDisable,i={productData:a("#woocommerce-product-data"),productType:a("select#product-type"),bookingDurationUnit:a("select#_yith_booking_duration_unit"),minuteSelect:a("#_yith_booking_duration_minute_select"),bookingDuration:a("#_yith_booking_duration"),bookingDurationType:a("select#_yith_booking_duration_type"),peopleEnabled:a("#_yith_booking_has_persons"),peopleTypesEnabled:a("#_yith_booking_enable_person_types"),canBeCancelled:a("#_yith_booking_can_be_cancelled")},n=function(){var e=!1;return wcbk_admin.prod_type===i.productType.val()&&((e={duration:parseInt(i.bookingDuration.val(),10),durationUnit:i.bookingDurationUnit.val(),durationType:i.bookingDurationType.val(),canBeCancelled:"yes"===i.canBeCancelled.val(),peopleEnabled:"yes"===i.peopleEnabled.val(),peopleTypesEnabled:"yes"===i.peopleTypesEnabled.val()}).hasTime=["hour","minute"].includes(e.durationUnit),e.isCustomerOneDay="customer"===e.durationType&&1===e.duration&&"day"===e.durationUnit,e.isFixedAndTime="fixed"===e.durationType&&e.hasTime),e},o=("yes"===wcbk_admin.isCreatingNewBookingProduct&&i.productType.val(wcbk_admin.prod_type).trigger("change"),{enablePrefix:".bk_enable_if_",conditions:{customer_chooses_blocks:"customer_chooses_blocks",can_be_cancelled:"can_be_cancelled",customer_one_day:"customer_one_day",booking_has_persons:"booking_has_persons",day:"day",time:"time",fixed_and_time:"fixed_and_time",unit_is_month:"unit_is_month",unit_is_day:"unit_is_day",unit_is_hour:"unit_is_hour",unit_is_minute:"unit_is_minute",people_and_people_types:"people_and_people_types"},initialProductType:"simple",init:function(){o.initialProductType=i.productType.val(),i.minuteSelect.hide().on("change",function(){i.bookingDuration.val(a(this).val()).trigger("change")}),a(document).find("._tax_status_field").closest("div").addClass("show_if_"+wcbk_admin.prod_type),i.productType.on("change",function(){o.initialProductType!==wcbk_admin.prod_type&&wcbk_admin.prod_type===a(this).val()&&a("#_virtual").attr("checked","checked").trigger("change")}).trigger("change"),i.bookingDurationUnit.on("change",function(){var e=a(this).val(),n="hour"===e||"minute"===e,t="day"===e;"minute"===e?(i.bookingDuration.hide(),i.minuteSelect.show().trigger("change")):(i.minuteSelect.hide(),i.bookingDuration.show()),a(document).trigger("yith_wcbk_booking_product_duration_unit_changed",[{value:e,has_time:n,is_day:t}])}).trigger("change")},handleEnabledFields:function(e){var n=o;e&&(n.handle(n.conditions.customer_chooses_blocks,"customer"===e.durationType),n.handle(n.conditions.can_be_cancelled,e.canBeCancelled),n.handle(n.conditions.customer_one_day,e.isCustomerOneDay),n.handle(n.conditions.fixed_and_time,e.isFixedAndTime),n.handle(n.conditions.booking_has_persons,e.peopleEnabled),n.handle(n.conditions.booking_has_persons,e.peopleEnabled&&e.peopleTypesEnabled),n.handle(n.conditions.time,e.hasTime),n.handle(n.conditions.day,"day"===e.durationUnit),n.handle(n.conditions.unit_is_month,"month"===e.durationUnit),n.handle(n.conditions.unit_is_day,"day"===e.durationUnit),n.handle(n.conditions.unit_is_hour,"hour"===e.durationUnit),n.handle(n.conditions.unit_is_minute,"minute"===e.durationUnit))},handle:function(e,n){e=o.enablePrefix+e;n?a(e).unblock():a(e).block(t)}}),c=(o.init(),{init:function(){i.productType.on("change",c.update),i.bookingDurationUnit.on("change",c.update),i.bookingDurationType.on("change",c.update),i.canBeCancelled.on("change",c.update),i.peopleEnabled.on("change",c.update),i.peopleTypesEnabled.on("change",c.update),a(document).on("change","#_yith_booking_duration_type, #_yith_booking_duration, #_yith_booking_duration_unit",c.update),c.update()},getClasses:function(e){var n=[];return e&&(n.push("bk_is_booking"),n.push("bk_duration_unit--"+e.durationUnit),n.push("bk_duration_type--"+e.durationType),e.hasTime&&n.push("bk_has_time"),e.canBeCancelled&&n.push("bk_can_be_cancelled"),e.isCustomerOneDay&&n.push("bk_is_customer_one_day"),e.isFixedAndTime&&n.push("bk_is_fixed_and_time"),e.peopleEnabled&&n.push("bk_has_people"),e.peopleEnabled)&&e.peopleTypesEnabled&&n.push("bk_has_people_and_people_types"),n},update:function(){var e=n(),t=c.getClasses(e);i.productData.removeClass(function(e,n){return n.split(/\s+/).filter(function(e){return 0===e.indexOf("bk_")&&!t.includes(e)}).join(" ")}),i.productData.addClass(t),o.handleEnabledFields(e)}}),s=(c.init(),a("#yith-wcbk-booking-costs-table")),d=s.find("tr.yith-wcbk-costs-default-row").first(),e=a("#yith-wcbk-costs-add-range"),l=a("#"+s.data("fields-container-id")),r=l.find(".yith-wcbk-admin-input-range"),_=l.find(".yith-wcbk-number-range"),u=l.find(".yith-wcbk-month-range-select"),p=l.find(".yith-wcbk-week-range-select"),b=l.find(".yith-wcbk-day-range-select"),l=(s.on("change","select.yith-wcbk-costs-range-type-select",function(e){var n,t,e=a(e.target),i=e.closest("tr"),o=i.find("td.yith-wcbk-costs-from"),i=i.find("td.yith-wcbk-costs-to"),e=e.val();switch(e){case"custom":n=r.clone().addClass("yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),t=r.clone().addClass("yith-wcbk-admin-date-picker").yith_wcbk_datepicker();break;case"month":n=u.clone(),t=u.clone();break;case"week":n=p.clone(),t=p.clone();break;case"day":n=b.clone(),t=b.clone();break;case"time":break;default:n=_.clone(),t=_.clone()}("time"===e?(n.find("input").attr("name","_yith_booking_costs_range[from][]"),t.find("input")):(n.attr("name","_yith_booking_costs_range[from][]"),t)).attr("name","_yith_booking_costs_range[to][]"),o.html(n),i.html(t)}).on("click",".yith-wcbk-delete",function(e){a(e.target).closest("tr").remove()}).find("tbody").sortable({items:"tr",cursor:"move",handle:".yith-wcbk-anchor",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,opacity:.65,helper:function(e,n){var t=n.children(),n=n.clone();return n.children().each(function(e){a(this).width(t.eq(e).width())}),n}}),e.on("click",function(){var e=d.clone().removeClass("yith-wcbk-costs-default-row");s.append(e),e.find("select.yith-wcbk-costs-range-type-select").trigger("change")}),function(){var e,n=i.bookingDurationUnit.val(),t=i.bookingDuration.val(),t=(t<2?(e=bk.i18n_durations[n].singular.replace("%s",t),bk.i18n_durations[n].singular_qty):(e=bk.i18n_durations[n].plural.replace("%s",t),bk.i18n_durations[n].plural_qty)).replace("%s",t),n=bk.i18n_durations[n].plural_unit;a(".yith-wcbk-product-metabox-dynamic-duration").html(e),a(".yith-wcbk-product-metabox-dynamic-duration-qty").html(t),a(".yith-wcbk-product-metabox-dynamic-duration-unit").html(n)}),h=(a(document).on("change","#_yith_booking_duration, #_yith_booking_duration_unit",l),a(document).on("yith_wcbk_product_metabox_dynamic_durations",l),l(),{expandCollapseButton:a(".yith-wcbk-people-types__expand-collapse"),list:a("#yith-wcbk-people-types__list"),init:function(){this.expandCollapseButton.on("click",this.expandCollapseAll)},expandCollapseAll:function(e){var e=a(e.target).closest(".yith-wcbk-people-types__expand-collapse"),n=h.list;(e.is(".yith-wcbk-people-types__expand-collapse--collapse")?(e.removeClass("yith-wcbk-people-types__expand-collapse--collapse"),n.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle")):(e.addClass("yith-wcbk-people-types__expand-collapse--collapse"),n.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle"))).click()}});h.init(),a(".yith-wcbk-product-sub-tab").last().addClass("yith-wcbk-product-sub-tab--last")});